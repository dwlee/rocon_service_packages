{"id":"3639e84ca7922ca434928f049a2efb1c","js":"var item;\nvar order_list;\nvar menus;\nvar pub_order_list;\nvar rec;\nvar stored_order_list;\nvar menu;\nvar list_count;\nvar last_order_empty;\nvar receivers;\nvar locations;\nvar receiver;\nvar now_tick_count;\nvar stored_order;\nvar pickup_waiter_res;\nvar order_status;\nvar find_complete_order;\n\n\n$engine.print(\"Rocon Authoring :\" + JSON.stringify('[Cafe Delivery] Cafe Delivery Start!!'));order_list = [];\n\nsetTimeout(function(){ Fiber(function(){  while (true) {\n    if (order_list.length > 0) {\n      pub_order_list = [];\n      for (var stored_order_list_index in order_list) {\n        stored_order_list = order_list[stored_order_list_index];\n        $engine.print(\"Rocon Authoring :\" + JSON.stringify(String('stored_order status : ') + String(stored_order_list['status'])));if (stored_order_list['status'] == 10) {\n          stored_order_list['start_time'] = _.now();} else {\n          now_tick_count = _.now();\n          stored_order_list['elapsed_time'] = now_tick_count - stored_order_list['start_time'];}\n        pub_order_list.push(({order_id:stored_order_list['order_id'], robot:stored_order_list['robot'], menus:stored_order_list['menus'], status:stored_order_list['status'], location:stored_order_list['location'], elapsed_time:stored_order_list['elapsed_time']}));\n      }\n      last_order_empty = false;\n      $engine.pub('/pickup_order_list', 'simple_delivery_msgs/OrderList', ({orders:pub_order_list}));} else {\n      if (last_order_empty == false) {\n        $engine.pub('/pickup_order_list', 'simple_delivery_msgs/OrderList', ({orders:[]}));last_order_empty = true;\n      }\n    }\n    $engine.sleep(1000);}\n}).run(); }, 0);\n$engine.subscribe('/pickup_send_order', 'simple_delivery_msgs/DeliveryOrder', function(item){   if (item['receivers'].length > 0) {\n    menus = [];\n    for (var rec_index in item['receivers']) {\n      rec = item['receivers'][rec_index];\n      for (var menu_index in rec['menus']) {\n        menu = rec['menus'][menu_index];\n        menus.push(menu);\n      }\n    }\n    $engine.print(\"Rocon Authoring :\" + JSON.stringify(['[Pickup Delivery] Push Order: [Cnt: ',menus.length,'] [',menus,']'].join('')));receivers = item['receivers'];\n    receiver = receivers[0];\n    order_list.push(({order_id:item['order_id'], robot:'', menus:menus, status:5, location:receiver['location'], start_time:_.now(), elapsed_time:0}));\n  }\n });\nsetTimeout(function(){ Fiber(function(){  $engine.sleep(3000);while (true) {\n    if (order_list.length > 0) {\n      $engine.print(\"Rocon Authoring :\" + JSON.stringify(['[Pickup Delivery] Remain Order: [Cnt: ',order_list.length,'] [',order_list,']'].join('')));locations = [];\n      menus = [];\n      list_count = 0;\n      for (var stored_order_index in order_list) {\n        stored_order = order_list[stored_order_index];\n        $engine.print(\"Rocon Authoring :\" + JSON.stringify(String('[Pickup Delivery] Order status: ') + String(stored_order['status'])));// initial status = 5\n        if (stored_order['status'] < 10) {\n          locations.push(stored_order['location']);\n          for (var menu_index2 in stored_order['menus']) {\n            menu = stored_order['menus'][menu_index2];\n            menus.push(menu);\n          }\n          $engine.print(\"Rocon Authoring :\" + JSON.stringify(['[Pickup Delivery] Assign new robot: [','] [order id: ',stored_order['order_id'],'] [locations: ',locations,'] [menus: ',menus,']'].join('')));stored_order['robot'] = 'pickup waiter';stored_order['status'] = 15;(function(pickup_waiter_res){ if(pickup_waiter_res){   $engine.print(\"Rocon Authoring :\" + JSON.stringify('[Pickup Delivery] Resource Allocation Success'));$engine.runScheduledAction(pickup_waiter_res, \"delivery_order\", \"simple_delivery_msgs/RobotDeliveryOrderAction\", ({\"order_id\":stored_order['order_id'],\"locations\":locations,\"menus\":menus}), function(item){   $engine.print(\"Rocon Authoring :\" + JSON.stringify(['[Pickup Delivery] Delivery Result [',item['order_id'],'][',item['success'],']'].join('')));if (item['success'] == false) {\n                if (item['status'] < '52') {\n                  $engine.print(\"Rocon Authoring :\" + JSON.stringify('[Pickup Delivery] Failed, try again'));stored_order['status'] = -10;} else {\n                  $engine.print(\"Rocon Authoring :\" + JSON.stringify(String('Order terminated :  ') + String(item['order_id'])));// Loop돌려서 리스트 안에 order id에 해당하는 주문을 제거\n                  order_list.splice(list_count - 1, 1);\n                }\n              } else {\n                $engine.print(\"Rocon Authoring :\" + JSON.stringify(String('Order finished(Success) :') + String(item['order_id'])));stored_order['status'] = 80;order_list.splice(list_count - 1, 1);\n              }\n              $engine.releaseResource(pickup_waiter_res);}, function(item){   order_status = item['delivery_status'];\n              $engine.print(\"Rocon Authoring :\" + JSON.stringify(['[Pickup Delivery] Delivery Feedback [',order_status['order_id'],'] [',order_status['status'],']'].join('')));for (var find_complete_order_index in order_list) {\n                find_complete_order = order_list[find_complete_order_index];\n                if (order_status['order_id'] == find_complete_order['order_id']) {\n                  $engine.print(\"Rocon Authoring :\" + JSON.stringify(String('feedback update id : ') + String(find_complete_order['order_id'])));find_complete_order['status'] = order_status['status'];}\n              }\n              $engine.pub('/delivery_status', 'simple_delivery_msgs/DeliveryStatus', item['delivery_status']);}, function(item){  $engine.print(\"Rocon Authoring :\" + JSON.stringify(['[Pickup Delivery] Delivery Timeout Result [',item['order_id'],'], status : ',item['status']].join('')));if (item['status'] < '52') {\n                $engine.print(\"Rocon Authoring :\" + JSON.stringify('[Pickup Delivery] Failed, try again'));stored_order['status'] = -10;} else {\n                $engine.print(\"Rocon Authoring :\" + JSON.stringify(String('Order terminated :  ') + String(item['order_id'])));order_list.splice(list_count - 1, 1);\n              }\n            }, {\"timeout\":$engine.getServiceParameter('drink_delivery', 'action_timeout')});$engine.print(\"Rocon Authoring :\" + JSON.stringify('[Drink Delivery] Send Action')); }else{   $engine.print(\"Rocon Authoring :\" + JSON.stringify('[Drink Delivery] Resource Allocation Failure'));} })($engine.allocateResource(\"concert_demo_rapps/pickup_delivery\", \"rocon:/waiterbot|turtlebot|pc\", [{\"remap_from\":\"map\",\"remap_to\":\"/map\"},{\"remap_from\":\"map_metadata\",\"remap_to\":\"/map_metadata\"},{\"remap_from\":\"table_pose_list\",\"remap_to\":\"/annotation/tables\"},{\"remap_from\":\"marker_pose_list\",\"remap_to\":\"/annotation/ar_markers\"},{\"remap_from\":\"viz_marker_pose_list\",\"remap_to\":\"/annotation/viz_tables\"},{\"remap_from\":\"delivery_order\",\"remap_to\":\"\"}], [{\"key\":\"volume\",\"value\":\"100\"}], {\"type\":\"dynamic\",\"timeout\":$engine.getServiceParameter('drink_delivery', 'alloc_timeout')}));}\n      }\n    }\n    list_count = list_count + 1;\n    $engine.sleep(3000);}\n}).run(); }, 0);","xml":"<xml xmlns=\"http://www.w3.org/1999/xhtml\"><block type=\"action_speak\" id=\"547\" inline=\"false\" x=\"-795\" y=\"-552\"><value name=\"VALUE\"><block type=\"text\" id=\"548\"><field name=\"TEXT\">[Cafe Delivery] Cafe Delivery Start!!</field></block></value><next><block type=\"variables_set\" id=\"549\" inline=\"true\"><field name=\"VAR\">order_list</field><value name=\"VALUE\"><block type=\"lists_create_empty\" id=\"550\"></block></value></block></next></block><block type=\"defer\" id=\"551\" x=\"354\" y=\"-576\"><statement name=\"DO\"><block type=\"controls_whileUntil\" id=\"552\" inline=\"false\"><field name=\"MODE\">WHILE</field><value name=\"BOOL\"><block type=\"logic_boolean\" id=\"553\"><field name=\"BOOL\">TRUE</field></block></value><statement name=\"DO\"><block type=\"controls_if\" id=\"554\" inline=\"false\"><mutation else=\"1\"></mutation><value name=\"IF0\"><block type=\"logic_compare\" id=\"555\" inline=\"true\"><field name=\"OP\">GT</field><value name=\"A\"><block type=\"lists_length\" id=\"556\" inline=\"false\"><value name=\"VALUE\"><block type=\"variables_get\" id=\"557\"><field name=\"VAR\">order_list</field></block></value></block></value><value name=\"B\"><block type=\"math_number\" id=\"558\"><field name=\"NUM\">0</field></block></value></block></value><statement name=\"DO0\"><block type=\"variables_set\" id=\"559\" inline=\"true\"><field name=\"VAR\">pub_order_list</field><value name=\"VALUE\"><block type=\"lists_create_empty\" id=\"560\"></block></value><next><block type=\"controls_forEach\" id=\"561\" inline=\"false\"><field name=\"VAR\">stored_order_list</field><value name=\"LIST\"><block type=\"variables_get\" id=\"562\"><field name=\"VAR\">order_list</field></block></value><statement name=\"DO\"><block type=\"action_speak\" id=\"563\" inline=\"false\"><value name=\"VALUE\"><block type=\"text_join\" id=\"564\" inline=\"false\"><mutation items=\"2\"></mutation><value name=\"ADD0\"><block type=\"text\" id=\"565\"><field name=\"TEXT\">stored_order status : </field></block></value><value name=\"ADD1\"><block type=\"object_item_get\" id=\"566\"><field name=\"VAR\">stored_order_list</field><field name=\"KEY\">status</field></block></value></block></value><next><block type=\"controls_if\" id=\"567\" inline=\"false\"><mutation else=\"1\"></mutation><value name=\"IF0\"><block type=\"logic_compare\" id=\"568\" inline=\"true\"><field name=\"OP\">EQ</field><value name=\"A\"><block type=\"object_item_get\" id=\"569\"><field name=\"VAR\">stored_order_list</field><field name=\"KEY\">status</field></block></value><value name=\"B\"><block type=\"math_number\" id=\"570\"><field name=\"NUM\">10</field></block></value></block></value><statement name=\"DO0\"><block type=\"object_item_set\" id=\"571\" inline=\"true\"><field name=\"VAR\">stored_order_list</field><field name=\"KEY\">start_time</field><value name=\"VALUE\"><block type=\"tick_count_get\" id=\"572\"></block></value></block></statement><statement name=\"ELSE\"><block type=\"variables_set\" id=\"573\" inline=\"true\"><field name=\"VAR\">now_tick_count</field><value name=\"VALUE\"><block type=\"tick_count_get\" id=\"574\"></block></value><next><block type=\"object_item_set\" id=\"575\" inline=\"true\"><field name=\"VAR\">stored_order_list</field><field name=\"KEY\">elapsed_time</field><value name=\"VALUE\"><block type=\"math_arithmetic\" id=\"576\" inline=\"true\"><field name=\"OP\">MINUS</field><value name=\"A\"><block type=\"variables_get\" id=\"577\"><field name=\"VAR\">now_tick_count</field></block></value><value name=\"B\"><block type=\"object_item_get\" id=\"578\"><field name=\"VAR\">stored_order_list</field><field name=\"KEY\">start_time</field></block></value></block></value></block></next></block></statement><next><block type=\"lists_setIndex\" id=\"579\" inline=\"true\"><mutation at=\"false\"></mutation><field name=\"MODE\">INSERT</field><field name=\"WHERE\">LAST</field><value name=\"LIST\"><block type=\"variables_get\" id=\"580\"><field name=\"VAR\">pub_order_list</field></block></value><value name=\"TO\"><block type=\"object_create_with\" id=\"581\" inline=\"false\"><mutation items=\"6\"></mutation><value name=\"ADD0\"><block type=\"object_item\" id=\"582\" inline=\"true\"><field name=\"KEY\">order_id</field><value name=\"VALUE\"><block type=\"object_item_get\" id=\"583\"><field name=\"VAR\">stored_order_list</field><field name=\"KEY\">order_id</field></block></value></block></value><value name=\"ADD1\"><block type=\"object_item\" id=\"584\" inline=\"true\"><field name=\"KEY\">robot</field><value name=\"VALUE\"><block type=\"object_item_get\" id=\"585\"><field name=\"VAR\">stored_order_list</field><field name=\"KEY\">robot</field></block></value></block></value><value name=\"ADD2\"><block type=\"object_item\" id=\"586\" inline=\"true\"><field name=\"KEY\">menus</field><value name=\"VALUE\"><block type=\"object_item_get\" id=\"587\"><field name=\"VAR\">stored_order_list</field><field name=\"KEY\">menus</field></block></value></block></value><value name=\"ADD3\"><block type=\"object_item\" id=\"588\" inline=\"true\"><field name=\"KEY\">status</field><value name=\"VALUE\"><block type=\"object_item_get\" id=\"589\"><field name=\"VAR\">stored_order_list</field><field name=\"KEY\">status</field></block></value></block></value><value name=\"ADD4\"><block type=\"object_item\" id=\"590\" inline=\"true\"><field name=\"KEY\">location</field><value name=\"VALUE\"><block type=\"object_item_get\" id=\"591\"><field name=\"VAR\">stored_order_list</field><field name=\"KEY\">location</field></block></value></block></value><value name=\"ADD5\"><block type=\"object_item\" id=\"592\" inline=\"true\"><field name=\"KEY\">elapsed_time</field><value name=\"VALUE\"><block type=\"object_item_get\" id=\"593\"><field name=\"VAR\">stored_order_list</field><field name=\"KEY\">elapsed_time</field></block></value></block></value></block></value></block></next></block></next></block></statement><next><block type=\"variables_set\" id=\"594\" inline=\"true\"><field name=\"VAR\">last_order_empty</field><value name=\"VALUE\"><block type=\"logic_boolean\" id=\"595\"><field name=\"BOOL\">FALSE</field></block></value><next><block type=\"ros_publish\" id=\"596\" inline=\"true\"><mutation></mutation><value name=\"NAME\"><block type=\"text\" id=\"597\"><field name=\"TEXT\">/pickup_order_list</field></block></value><value name=\"TYPE\"><block type=\"text\" id=\"598\"><field name=\"TEXT\">simple_delivery_msgs/OrderList</field></block></value><value name=\"VALUE\"><block type=\"object_create_with\" id=\"599\" inline=\"false\"><mutation items=\"1\"></mutation><value name=\"ADD0\"><block type=\"object_item\" id=\"600\" inline=\"true\"><field name=\"KEY\">orders</field><value name=\"VALUE\"><block type=\"variables_get\" id=\"601\"><field name=\"VAR\">pub_order_list</field></block></value></block></value></block></value></block></next></block></next></block></next></block></statement><statement name=\"ELSE\"><block type=\"controls_if\" id=\"602\" inline=\"false\"><value name=\"IF0\"><block type=\"logic_compare\" id=\"603\" inline=\"true\"><field name=\"OP\">EQ</field><value name=\"A\"><block type=\"variables_get\" id=\"604\"><field name=\"VAR\">last_order_empty</field></block></value><value name=\"B\"><block type=\"logic_boolean\" id=\"605\"><field name=\"BOOL\">FALSE</field></block></value></block></value><statement name=\"DO0\"><block type=\"ros_publish\" id=\"606\" inline=\"true\"><mutation></mutation><value name=\"NAME\"><block type=\"text\" id=\"607\"><field name=\"TEXT\">/pickup_order_list</field></block></value><value name=\"TYPE\"><block type=\"text\" id=\"608\"><field name=\"TEXT\">simple_delivery_msgs/OrderList</field></block></value><value name=\"VALUE\"><block type=\"object_create_with\" id=\"609\" inline=\"false\"><mutation items=\"1\"></mutation><value name=\"ADD0\"><block type=\"object_item\" id=\"610\" inline=\"true\"><field name=\"KEY\">orders</field><value name=\"VALUE\"><block type=\"lists_create_empty\" id=\"611\"></block></value></block></value></block></value><next><block type=\"variables_set\" id=\"612\" inline=\"true\"><field name=\"VAR\">last_order_empty</field><value name=\"VALUE\"><block type=\"logic_boolean\" id=\"613\"><field name=\"BOOL\">TRUE</field></block></value></block></next></block></statement></block></statement><next><block type=\"action_sleep\" id=\"614\" inline=\"false\"><value name=\"VALUE\"><block type=\"math_number\" id=\"615\"><field name=\"NUM\">1000</field></block></value></block></next></block></statement></block></statement></block><block type=\"ros_subscribe_send_order-web_app(http://__WEBSERVER_ADDRESS__/concert_common_web_interface/pickup_delivery_order/index.html)\" id=\"616\" x=\"-806\" y=\"-362\"><mutation extra=\"{&quot;client_app_name&quot;:&quot;web_app(http://__WEBSERVER_ADDRESS__/concert_common_web_interface/pickup_delivery_order/index.html)&quot;,&quot;tooltip&quot;:&quot;web_app(http://__WEBSERVER_ADDRESS__/concert_common_web_interface/pickup_delivery_order/index.html)&quot;}\"></mutation><field name=\"DO_PARAM\">item</field><statement name=\"DO\"><block type=\"controls_if\" id=\"617\" inline=\"false\"><value name=\"IF0\"><block type=\"logic_compare\" id=\"618\" inline=\"true\"><field name=\"OP\">GT</field><value name=\"A\"><block type=\"lists_length\" id=\"619\" inline=\"false\"><value name=\"VALUE\"><block type=\"object_item_get\" id=\"620\"><field name=\"VAR\">item</field><field name=\"KEY\">receivers</field></block></value></block></value><value name=\"B\"><block type=\"math_number\" id=\"621\"><field name=\"NUM\">0</field></block></value></block></value><statement name=\"DO0\"><block type=\"variables_set\" id=\"622\" inline=\"true\"><field name=\"VAR\">menus</field><value name=\"VALUE\"><block type=\"lists_create_empty\" id=\"623\"></block></value><next><block type=\"controls_forEach\" id=\"624\" inline=\"false\"><field name=\"VAR\">rec</field><value name=\"LIST\"><block type=\"object_item_get\" id=\"625\"><field name=\"VAR\">item</field><field name=\"KEY\">receivers</field></block></value><statement name=\"DO\"><block type=\"controls_forEach\" id=\"626\" inline=\"false\"><field name=\"VAR\">menu</field><value name=\"LIST\"><block type=\"object_item_get\" id=\"627\"><field name=\"VAR\">rec</field><field name=\"KEY\">menus</field></block></value><statement name=\"DO\"><block type=\"lists_setIndex\" id=\"628\" inline=\"true\"><mutation at=\"false\"></mutation><field name=\"MODE\">INSERT</field><field name=\"WHERE\">LAST</field><value name=\"LIST\"><block type=\"variables_get\" id=\"629\"><field name=\"VAR\">menus</field></block></value><value name=\"TO\"><block type=\"variables_get\" id=\"630\"><field name=\"VAR\">menu</field></block></value></block></statement></block></statement><next><block type=\"action_speak\" id=\"631\" inline=\"false\"><value name=\"VALUE\"><block type=\"text_join\" id=\"632\" inline=\"false\"><mutation items=\"5\"></mutation><value name=\"ADD0\"><block type=\"text\" id=\"633\"><field name=\"TEXT\">[Pickup Delivery] Push Order: [Cnt: </field></block></value><value name=\"ADD1\"><block type=\"lists_length\" id=\"634\" inline=\"false\"><value name=\"VALUE\"><block type=\"variables_get\" id=\"635\"><field name=\"VAR\">menus</field></block></value></block></value><value name=\"ADD2\"><block type=\"text\" id=\"636\"><field name=\"TEXT\">] [</field></block></value><value name=\"ADD3\"><block type=\"variables_get\" id=\"637\"><field name=\"VAR\">menus</field></block></value><value name=\"ADD4\"><block type=\"text\" id=\"638\"><field name=\"TEXT\">]</field></block></value></block></value><next><block type=\"variables_set\" id=\"639\" inline=\"true\"><field name=\"VAR\">receivers</field><value name=\"VALUE\"><block type=\"object_item_get\" id=\"640\"><field name=\"VAR\">item</field><field name=\"KEY\">receivers</field></block></value><next><block type=\"variables_set\" id=\"641\" inline=\"true\"><field name=\"VAR\">receiver</field><value name=\"VALUE\"><block type=\"lists_getIndex\" id=\"642\" inline=\"true\"><mutation statement=\"false\" at=\"false\"></mutation><field name=\"MODE\">GET</field><field name=\"WHERE\">FIRST</field><value name=\"VALUE\"><block type=\"variables_get\" id=\"643\"><field name=\"VAR\">receivers</field></block></value></block></value><next><block type=\"lists_setIndex\" id=\"644\" inline=\"true\"><mutation at=\"false\"></mutation><field name=\"MODE\">INSERT</field><field name=\"WHERE\">LAST</field><value name=\"LIST\"><block type=\"variables_get\" id=\"645\"><field name=\"VAR\">order_list</field></block></value><value name=\"TO\"><block type=\"object_create_with\" id=\"646\" inline=\"false\"><mutation items=\"7\"></mutation><value name=\"ADD0\"><block type=\"object_item\" id=\"647\" inline=\"true\"><field name=\"KEY\">order_id</field><value name=\"VALUE\"><block type=\"object_item_get\" id=\"648\"><field name=\"VAR\">item</field><field name=\"KEY\">order_id</field></block></value></block></value><value name=\"ADD1\"><block type=\"object_item\" id=\"649\" inline=\"true\"><field name=\"KEY\">robot</field><value name=\"VALUE\"><block type=\"text\" id=\"650\"><field name=\"TEXT\"></field></block></value></block></value><value name=\"ADD2\"><block type=\"object_item\" id=\"651\" inline=\"true\"><field name=\"KEY\">menus</field><value name=\"VALUE\"><block type=\"variables_get\" id=\"652\"><field name=\"VAR\">menus</field></block></value></block></value><value name=\"ADD3\"><block type=\"object_item\" id=\"653\" inline=\"true\"><field name=\"KEY\">status</field><value name=\"VALUE\"><block type=\"math_number\" id=\"654\"><field name=\"NUM\">5</field></block></value></block></value><value name=\"ADD4\"><block type=\"object_item\" id=\"655\" inline=\"true\"><field name=\"KEY\">location</field><value name=\"VALUE\"><block type=\"object_item_get\" id=\"656\"><field name=\"VAR\">receiver</field><field name=\"KEY\">location</field></block></value></block></value><value name=\"ADD5\"><block type=\"object_item\" id=\"657\" inline=\"true\"><field name=\"KEY\">start_time</field><value name=\"VALUE\"><block type=\"tick_count_get\" id=\"658\"></block></value></block></value><value name=\"ADD6\"><block type=\"object_item\" id=\"659\" inline=\"true\"><field name=\"KEY\">elapsed_time</field><value name=\"VALUE\"><block type=\"math_number\" id=\"660\"><field name=\"NUM\">0</field></block></value></block></value></block></value></block></next></block></next></block></next></block></next></block></next></block></statement></block></statement></block><block type=\"defer\" id=\"661\" x=\"-808\" y=\"454\"><statement name=\"DO\"><block type=\"action_sleep\" id=\"662\" inline=\"false\"><value name=\"VALUE\"><block type=\"math_number\" id=\"663\"><field name=\"NUM\">3000</field></block></value><next><block type=\"controls_whileUntil\" id=\"664\" inline=\"false\"><field name=\"MODE\">WHILE</field><value name=\"BOOL\"><block type=\"logic_boolean\" id=\"665\"><field name=\"BOOL\">TRUE</field></block></value><statement name=\"DO\"><block type=\"controls_if\" id=\"666\" inline=\"false\"><value name=\"IF0\"><block type=\"logic_compare\" id=\"667\" inline=\"true\"><field name=\"OP\">GT</field><value name=\"A\"><block type=\"lists_length\" id=\"668\" inline=\"false\"><value name=\"VALUE\"><block type=\"variables_get\" id=\"669\"><field name=\"VAR\">order_list</field></block></value></block></value><value name=\"B\"><block type=\"math_number\" id=\"670\"><field name=\"NUM\">0</field></block></value></block></value><statement name=\"DO0\"><block type=\"action_speak\" id=\"671\" inline=\"false\"><value name=\"VALUE\"><block type=\"text_join\" id=\"672\" inline=\"false\"><mutation items=\"5\"></mutation><value name=\"ADD0\"><block type=\"text\" id=\"673\"><field name=\"TEXT\">[Pickup Delivery] Remain Order: [Cnt: </field></block></value><value name=\"ADD1\"><block type=\"lists_length\" id=\"674\" inline=\"false\"><value name=\"VALUE\"><block type=\"variables_get\" id=\"675\"><field name=\"VAR\">order_list</field></block></value></block></value><value name=\"ADD2\"><block type=\"text\" id=\"676\"><field name=\"TEXT\">] [</field></block></value><value name=\"ADD3\"><block type=\"variables_get\" id=\"677\"><field name=\"VAR\">order_list</field></block></value><value name=\"ADD4\"><block type=\"text\" id=\"678\"><field name=\"TEXT\">]</field></block></value></block></value><next><block type=\"variables_set\" id=\"679\" inline=\"true\"><field name=\"VAR\">locations</field><value name=\"VALUE\"><block type=\"lists_create_empty\" id=\"680\"></block></value><next><block type=\"variables_set\" id=\"681\" inline=\"true\"><field name=\"VAR\">menus</field><value name=\"VALUE\"><block type=\"lists_create_empty\" id=\"682\"></block></value><next><block type=\"variables_set\" id=\"683\" inline=\"true\"><field name=\"VAR\">list_count</field><value name=\"VALUE\"><block type=\"math_number\" id=\"684\"><field name=\"NUM\">0</field></block></value><next><block type=\"controls_forEach\" id=\"685\" inline=\"false\"><field name=\"VAR\">stored_order</field><value name=\"LIST\"><block type=\"variables_get\" id=\"686\"><field name=\"VAR\">order_list</field></block></value><statement name=\"DO\"><block type=\"action_speak\" id=\"687\" inline=\"false\"><value name=\"VALUE\"><block type=\"text_join\" id=\"688\" inline=\"false\"><mutation items=\"2\"></mutation><value name=\"ADD0\"><block type=\"text\" id=\"689\"><field name=\"TEXT\">[Pickup Delivery] Order status: </field></block></value><value name=\"ADD1\"><block type=\"object_item_get\" id=\"690\"><field name=\"VAR\">stored_order</field><field name=\"KEY\">status</field></block></value></block></value><next><block type=\"controls_if\" id=\"691\" inline=\"false\"><value name=\"IF0\"><block type=\"logic_compare\" id=\"692\" inline=\"true\"><field name=\"OP\">LT</field><comment pinned=\"false\" h=\"80\" w=\"160\">initial status = 5</comment><value name=\"A\"><block type=\"object_item_get\" id=\"693\"><field name=\"VAR\">stored_order</field><field name=\"KEY\">status</field></block></value><value name=\"B\"><block type=\"math_number\" id=\"694\"><field name=\"NUM\">10</field></block></value></block></value><statement name=\"DO0\"><block type=\"lists_setIndex\" id=\"695\" inline=\"true\"><mutation at=\"false\"></mutation><field name=\"MODE\">INSERT</field><field name=\"WHERE\">LAST</field><value name=\"LIST\"><block type=\"variables_get\" id=\"696\"><field name=\"VAR\">locations</field></block></value><value name=\"TO\"><block type=\"object_item_get\" id=\"697\"><field name=\"VAR\">stored_order</field><field name=\"KEY\">location</field></block></value><next><block type=\"controls_forEach\" id=\"698\" inline=\"false\"><field name=\"VAR\">menu</field><value name=\"LIST\"><block type=\"object_item_get\" id=\"699\"><field name=\"VAR\">stored_order</field><field name=\"KEY\">menus</field></block></value><statement name=\"DO\"><block type=\"lists_setIndex\" id=\"700\" inline=\"true\"><mutation at=\"false\"></mutation><field name=\"MODE\">INSERT</field><field name=\"WHERE\">LAST</field><value name=\"LIST\"><block type=\"variables_get\" id=\"701\"><field name=\"VAR\">menus</field></block></value><value name=\"TO\"><block type=\"variables_get\" id=\"702\"><field name=\"VAR\">menu</field></block></value></block></statement><next><block type=\"action_speak\" id=\"703\" inline=\"false\"><value name=\"VALUE\"><block type=\"text_join\" id=\"704\" inline=\"false\"><mutation items=\"8\"></mutation><value name=\"ADD0\"><block type=\"text\" id=\"705\"><field name=\"TEXT\">[Pickup Delivery] Assign new robot: [</field></block></value><value name=\"ADD1\"><block type=\"text\" id=\"706\"><field name=\"TEXT\">] [order id: </field></block></value><value name=\"ADD2\"><block type=\"object_item_get\" id=\"707\"><field name=\"VAR\">stored_order</field><field name=\"KEY\">order_id</field></block></value><value name=\"ADD3\"><block type=\"text\" id=\"708\"><field name=\"TEXT\">] [locations: </field></block></value><value name=\"ADD4\"><block type=\"variables_get\" id=\"709\"><field name=\"VAR\">locations</field></block></value><value name=\"ADD5\"><block type=\"text\" id=\"710\"><field name=\"TEXT\">] [menus: </field></block></value><value name=\"ADD6\"><block type=\"variables_get\" id=\"711\"><field name=\"VAR\">menus</field></block></value><value name=\"ADD7\"><block type=\"text\" id=\"712\"><field name=\"TEXT\">]</field></block></value></block></value><next><block type=\"object_item_set\" id=\"713\" inline=\"true\"><field name=\"VAR\">stored_order</field><field name=\"KEY\">robot</field><value name=\"VALUE\"><block type=\"text\" id=\"714\"><field name=\"TEXT\">pickup waiter</field></block></value><next><block type=\"object_item_set\" id=\"715\" inline=\"true\"><field name=\"VAR\">stored_order</field><field name=\"KEY\">status</field><value name=\"VALUE\"><block type=\"math_number\" id=\"716\"><field name=\"NUM\">15</field></block></value><next><block type=\"ros_requester_allocate_with_block2\" id=\"717\" inline=\"false\"><mutation extra_config=\"{&quot;timeout&quot;:&quot;15000000000&quot;,&quot;remappings&quot;:[{&quot;remap_from&quot;:&quot;map&quot;,&quot;remap_to&quot;:&quot;/map&quot;},{&quot;remap_from&quot;:&quot;map_metadata&quot;,&quot;remap_to&quot;:&quot;/map_metadata&quot;},{&quot;remap_from&quot;:&quot;table_pose_list&quot;,&quot;remap_to&quot;:&quot;/annotation/tables&quot;},{&quot;remap_from&quot;:&quot;marker_pose_list&quot;,&quot;remap_to&quot;:&quot;/annotation/ar_markers&quot;},{&quot;remap_from&quot;:&quot;viz_marker_pose_list&quot;,&quot;remap_to&quot;:&quot;/annotation/viz_tables&quot;},{&quot;remap_from&quot;:&quot;delivery_order&quot;,&quot;remap_to&quot;:&quot;&quot;}],&quot;parameters&quot;:[{&quot;key&quot;:&quot;volume&quot;,&quot;value&quot;:&quot;100&quot;}],&quot;rapp&quot;:&quot;concert_demo_rapps/pickup_delivery&quot;,&quot;uri&quot;:&quot;rocon:/waiterbot|turtlebot|pc&quot;}\"></mutation><field name=\"TYPE\">dynamic</field><field name=\"ON_SUCCESS_PARAM\">pickup_waiter_res</field><value name=\"TIMEOUT_ALLOC\"><block type=\"ros_parameter\" id=\"718\"><mutation></mutation><field name=\"KEY\">alloc_timeout</field></block></value><statement name=\"ON_SUCCESS\"><block type=\"action_speak\" id=\"719\" inline=\"false\"><value name=\"VALUE\"><block type=\"text\" id=\"720\"><field name=\"TEXT\">[Pickup Delivery] Resource Allocation Success</field></block></value><next><block type=\"ros_scheduled_action_t_delivery_order\" id=\"721\" inline=\"true\"><mutation></mutation><field name=\"ON_RESULT_PARAM\">item</field><field name=\"ON_FEEDBACK_PARAM\">item</field><field name=\"ON_TIMEOUT_PARAM\">item</field><value name=\"CTX\"><block type=\"variables_get\" id=\"722\"><field name=\"VAR\">pickup_waiter_res</field></block></value><value name=\"GOAL\"><block type=\"ros_msg_simple_delivery_msgs-RobotDeliveryOrderGoal\" id=\"723\" inline=\"false\"><mutation></mutation><value name=\"ORDER_ID\"><block type=\"object_item_get\" id=\"724\"><field name=\"VAR\">stored_order</field><field name=\"KEY\">order_id</field></block></value><value name=\"LOCATIONS\"><block type=\"variables_get\" id=\"725\"><field name=\"VAR\">locations</field></block></value><value name=\"MENUS\"><block type=\"variables_get\" id=\"726\"><field name=\"VAR\">menus</field></block></value></block></value><value name=\"TIMEOUT\"><block type=\"ros_parameter\" id=\"727\"><mutation></mutation><field name=\"KEY\">action_timeout</field></block></value><statement name=\"ON_RESULT\"><block type=\"action_speak\" id=\"728\" inline=\"false\"><value name=\"VALUE\"><block type=\"text_join\" id=\"729\" inline=\"false\"><mutation items=\"5\"></mutation><value name=\"ADD0\"><block type=\"text\" id=\"730\"><field name=\"TEXT\">[Pickup Delivery] Delivery Result [</field></block></value><value name=\"ADD1\"><block type=\"object_item_get\" id=\"731\"><field name=\"VAR\">item</field><field name=\"KEY\">order_id</field></block></value><value name=\"ADD2\"><block type=\"text\" id=\"732\"><field name=\"TEXT\">][</field></block></value><value name=\"ADD3\"><block type=\"object_item_get\" id=\"733\"><field name=\"VAR\">item</field><field name=\"KEY\">success</field></block></value><value name=\"ADD4\"><block type=\"text\" id=\"734\"><field name=\"TEXT\">]</field></block></value></block></value><next><block type=\"controls_if\" id=\"735\" inline=\"false\"><mutation else=\"1\"></mutation><value name=\"IF0\"><block type=\"logic_compare\" id=\"736\" inline=\"true\"><field name=\"OP\">EQ</field><value name=\"A\"><block type=\"object_item_get\" id=\"737\"><field name=\"VAR\">item</field><field name=\"KEY\">success</field></block></value><value name=\"B\"><block type=\"logic_boolean\" id=\"738\"><field name=\"BOOL\">FALSE</field></block></value></block></value><statement name=\"DO0\"><block type=\"controls_if\" id=\"739\" inline=\"false\"><mutation else=\"1\"></mutation><value name=\"IF0\"><block type=\"logic_compare\" id=\"740\" inline=\"true\"><field name=\"OP\">LT</field><value name=\"A\"><block type=\"object_item_get\" id=\"741\"><field name=\"VAR\">item</field><field name=\"KEY\">status</field></block></value><value name=\"B\"><block type=\"text\" id=\"742\"><field name=\"TEXT\">52</field></block></value></block></value><statement name=\"DO0\"><block type=\"action_speak\" id=\"743\" inline=\"false\"><value name=\"VALUE\"><block type=\"text\" id=\"744\"><field name=\"TEXT\">[Pickup Delivery] Failed, try again</field></block></value><next><block type=\"object_item_set\" id=\"745\" inline=\"true\"><field name=\"VAR\">stored_order</field><field name=\"KEY\">status</field><value name=\"VALUE\"><block type=\"math_number\" id=\"746\"><field name=\"NUM\">-10</field></block></value></block></next></block></statement><statement name=\"ELSE\"><block type=\"action_speak\" id=\"747\" inline=\"false\"><value name=\"VALUE\"><block type=\"text_join\" id=\"748\" inline=\"false\"><mutation items=\"2\"></mutation><value name=\"ADD0\"><block type=\"text\" id=\"749\"><field name=\"TEXT\">Order terminated :  </field></block></value><value name=\"ADD1\"><block type=\"object_item_get\" id=\"750\"><field name=\"VAR\">item</field><field name=\"KEY\">order_id</field></block></value></block></value><next><block type=\"lists_getIndex\" id=\"751\" inline=\"true\"><mutation statement=\"true\" at=\"true\"></mutation><field name=\"MODE\">REMOVE</field><field name=\"WHERE\">FROM_START</field><comment pinned=\"false\" h=\"80\" w=\"160\">Loop돌려서 리스트 안에 order id에 해당하는 주문을 제거</comment><value name=\"VALUE\"><block type=\"variables_get\" id=\"752\"><field name=\"VAR\">order_list</field></block></value><value name=\"AT\"><block type=\"variables_get\" id=\"753\"><field name=\"VAR\">list_count</field></block></value></block></next></block></statement></block></statement><statement name=\"ELSE\"><block type=\"action_speak\" id=\"754\" inline=\"false\"><value name=\"VALUE\"><block type=\"text_join\" id=\"755\" inline=\"false\"><mutation items=\"2\"></mutation><value name=\"ADD0\"><block type=\"text\" id=\"756\"><field name=\"TEXT\">Order finished(Success) :</field></block></value><value name=\"ADD1\"><block type=\"object_item_get\" id=\"757\"><field name=\"VAR\">item</field><field name=\"KEY\">order_id</field></block></value></block></value><next><block type=\"object_item_set\" id=\"758\" inline=\"true\"><field name=\"VAR\">stored_order</field><field name=\"KEY\">status</field><value name=\"VALUE\"><block type=\"math_number\" id=\"759\"><field name=\"NUM\">80</field></block></value><next><block type=\"lists_getIndex\" id=\"760\" inline=\"true\"><mutation statement=\"true\" at=\"true\"></mutation><field name=\"MODE\">REMOVE</field><field name=\"WHERE\">FROM_START</field><value name=\"VALUE\"><block type=\"variables_get\" id=\"761\"><field name=\"VAR\">order_list</field></block></value><value name=\"AT\"><block type=\"variables_get\" id=\"762\"><field name=\"VAR\">list_count</field></block></value></block></next></block></next></block></statement><next><block type=\"ros_requester_release\" id=\"763\" inline=\"false\"><mutation></mutation><value name=\"CTX\"><block type=\"variables_get\" id=\"764\"><field name=\"VAR\">pickup_waiter_res</field></block></value></block></next></block></next></block></statement><statement name=\"ON_FEEDBACK\"><block type=\"variables_set\" id=\"765\" inline=\"true\"><field name=\"VAR\">order_status</field><value name=\"VALUE\"><block type=\"object_item_get\" id=\"766\"><field name=\"VAR\">item</field><field name=\"KEY\">delivery_status</field></block></value><next><block type=\"action_speak\" id=\"767\" inline=\"false\"><value name=\"VALUE\"><block type=\"text_join\" id=\"768\" inline=\"false\"><mutation items=\"5\"></mutation><value name=\"ADD0\"><block type=\"text\" id=\"769\"><field name=\"TEXT\">[Pickup Delivery] Delivery Feedback [</field></block></value><value name=\"ADD1\"><block type=\"object_item_get\" id=\"770\"><field name=\"VAR\">order_status</field><field name=\"KEY\">order_id</field></block></value><value name=\"ADD2\"><block type=\"text\" id=\"771\"><field name=\"TEXT\">] [</field></block></value><value name=\"ADD3\"><block type=\"object_item_get\" id=\"772\"><field name=\"VAR\">order_status</field><field name=\"KEY\">status</field></block></value><value name=\"ADD4\"><block type=\"text\" id=\"773\"><field name=\"TEXT\">]</field></block></value></block></value><next><block type=\"controls_forEach\" id=\"774\" inline=\"false\"><field name=\"VAR\">find_complete_order</field><value name=\"LIST\"><block type=\"variables_get\" id=\"775\"><field name=\"VAR\">order_list</field></block></value><statement name=\"DO\"><block type=\"controls_if\" id=\"776\" inline=\"false\"><value name=\"IF0\"><block type=\"logic_compare\" id=\"777\" inline=\"true\"><field name=\"OP\">EQ</field><value name=\"A\"><block type=\"object_item_get\" id=\"778\"><field name=\"VAR\">order_status</field><field name=\"KEY\">order_id</field></block></value><value name=\"B\"><block type=\"object_item_get\" id=\"779\"><field name=\"VAR\">find_complete_order</field><field name=\"KEY\">order_id</field></block></value></block></value><statement name=\"DO0\"><block type=\"action_speak\" id=\"780\" inline=\"false\"><value name=\"VALUE\"><block type=\"text_join\" id=\"781\" inline=\"false\"><mutation items=\"2\"></mutation><value name=\"ADD0\"><block type=\"text\" id=\"782\"><field name=\"TEXT\">feedback update id : </field></block></value><value name=\"ADD1\"><block type=\"object_item_get\" id=\"783\"><field name=\"VAR\">find_complete_order</field><field name=\"KEY\">order_id</field></block></value></block></value><next><block type=\"object_item_set\" id=\"784\" inline=\"true\"><field name=\"VAR\">find_complete_order</field><field name=\"KEY\">status</field><value name=\"VALUE\"><block type=\"object_item_get\" id=\"785\"><field name=\"VAR\">order_status</field><field name=\"KEY\">status</field></block></value></block></next></block></statement></block></statement><next><block type=\"ros_publish\" id=\"786\" inline=\"true\"><mutation></mutation><value name=\"NAME\"><block type=\"text\" id=\"787\"><field name=\"TEXT\">/delivery_status</field></block></value><value name=\"TYPE\"><block type=\"text\" id=\"788\"><field name=\"TEXT\">simple_delivery_msgs/DeliveryStatus</field></block></value><value name=\"VALUE\"><block type=\"object_item_get\" id=\"789\"><field name=\"VAR\">item</field><field name=\"KEY\">delivery_status</field></block></value></block></next></block></next></block></next></block></statement><statement name=\"ON_TIMEOUT\"><block type=\"action_speak\" id=\"790\" inline=\"false\"><value name=\"VALUE\"><block type=\"text_join\" id=\"791\" inline=\"false\"><mutation items=\"4\"></mutation><value name=\"ADD0\"><block type=\"text\" id=\"792\"><field name=\"TEXT\">[Pickup Delivery] Delivery Timeout Result [</field></block></value><value name=\"ADD1\"><block type=\"object_item_get\" id=\"793\"><field name=\"VAR\">item</field><field name=\"KEY\">order_id</field></block></value><value name=\"ADD2\"><block type=\"text\" id=\"794\"><field name=\"TEXT\">], status : </field></block></value><value name=\"ADD3\"><block type=\"object_item_get\" id=\"826\"><field name=\"VAR\">item</field><field name=\"KEY\">status</field></block></value></block></value><next><block type=\"controls_if\" id=\"795\" inline=\"false\"><mutation else=\"1\"></mutation><value name=\"IF0\"><block type=\"logic_compare\" id=\"796\" inline=\"true\"><field name=\"OP\">LT</field><value name=\"A\"><block type=\"object_item_get\" id=\"797\"><field name=\"VAR\">item</field><field name=\"KEY\">status</field></block></value><value name=\"B\"><block type=\"text\" id=\"798\"><field name=\"TEXT\">52</field></block></value></block></value><statement name=\"DO0\"><block type=\"action_speak\" id=\"799\" inline=\"false\"><value name=\"VALUE\"><block type=\"text\" id=\"800\"><field name=\"TEXT\">[Pickup Delivery] Failed, try again</field></block></value><next><block type=\"object_item_set\" id=\"801\" inline=\"true\"><field name=\"VAR\">stored_order</field><field name=\"KEY\">status</field><value name=\"VALUE\"><block type=\"math_number\" id=\"802\"><field name=\"NUM\">-10</field></block></value></block></next></block></statement><statement name=\"ELSE\"><block type=\"action_speak\" id=\"803\" inline=\"false\"><value name=\"VALUE\"><block type=\"text_join\" id=\"804\" inline=\"false\"><mutation items=\"2\"></mutation><value name=\"ADD0\"><block type=\"text\" id=\"805\"><field name=\"TEXT\">Order terminated :  </field></block></value><value name=\"ADD1\"><block type=\"object_item_get\" id=\"806\"><field name=\"VAR\">item</field><field name=\"KEY\">order_id</field></block></value></block></value><next><block type=\"lists_getIndex\" id=\"807\" inline=\"true\"><mutation statement=\"true\" at=\"true\"></mutation><field name=\"MODE\">REMOVE</field><field name=\"WHERE\">FROM_START</field><value name=\"VALUE\"><block type=\"variables_get\" id=\"808\"><field name=\"VAR\">order_list</field></block></value><value name=\"AT\"><block type=\"variables_get\" id=\"809\"><field name=\"VAR\">list_count</field></block></value></block></next></block></statement></block></next></block></statement><next><block type=\"action_speak\" id=\"810\" inline=\"false\"><value name=\"VALUE\"><block type=\"text\" id=\"811\"><field name=\"TEXT\">[Drink Delivery] Send Action</field></block></value></block></next></block></next></block></statement><statement name=\"ON_FAIL\"><block type=\"action_speak\" id=\"812\" inline=\"false\"><value name=\"VALUE\"><block type=\"text\" id=\"813\"><field name=\"TEXT\">[Drink Delivery] Resource Allocation Failure</field></block></value></block></statement></block></next></block></next></block></next></block></next></block></next></block></statement></block></next></block></statement></block></next></block></next></block></next></block></next></block></statement><next><block type=\"variables_set\" id=\"814\" inline=\"true\"><field name=\"VAR\">list_count</field><value name=\"VALUE\"><block type=\"math_arithmetic\" id=\"815\" inline=\"true\"><field name=\"OP\">ADD</field><value name=\"A\"><block type=\"variables_get\" id=\"816\"><field name=\"VAR\">list_count</field></block></value><value name=\"B\"><block type=\"math_number\" id=\"817\"><field name=\"NUM\">1</field></block></value></block></value><next><block type=\"action_sleep\" id=\"818\" inline=\"false\"><value name=\"VALUE\"><block type=\"math_number\" id=\"819\"><field name=\"NUM\">3000</field></block></value></block></next></block></next></block></statement></block></next></block></statement></block></xml>","title":"drink_delivery_wf","description":"\n"}