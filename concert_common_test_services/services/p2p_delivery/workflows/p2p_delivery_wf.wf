{"id":"14a8fb279a704138808ddc87cf5f517d","js":"var item;\nvar p2p_waiterbot;\nvar p2p_delivery_status;\n\n\n$engine.print(\"Rocon Authoring :\" + JSON.stringify('Start P2P delivery service'));\n$engine.subscribe('/p2p_delivery_order_from_ui', 'simple_delivery_msgs/P2PDeliveryOrder4UI', function(item){   setTimeout(function(){ Fiber(function(){  $engine.print(\"Rocon Authoring :\" + JSON.stringify(['[p2p_delivery_order id] ',item['id'],'[sender] ',item['sender'],'[receiver] ',item['receiver']].join('')));(function(p2p_waiterbot){ if(p2p_waiterbot){   $engine.print(\"Rocon Authoring :\" + JSON.stringify('Resource allocation succeeded for P2P delivery'));$engine.runScheduledAction(p2p_waiterbot, \"p2p_delivery_order\", \"simple_delivery_msgs/P2PDeliveryOrderAction\", ({\"order_id\":item['id'],\"sender\":item['sender'],\"receiver\":item['receiver'],\"message\":'HELLOW'}), function(item){   $engine.print(\"Rocon Authoring :\" + JSON.stringify(['[order_id] ',item['order_id'],'[success] ',item['success']].join('')));}, function(item){   p2p_delivery_status = item['delivery_status'];\n        $engine.print(\"Rocon Authoring :\" + JSON.stringify(['[p2p_delivery_order id] ',p2p_delivery_status['id'],'[target_goal] ',p2p_delivery_status['target_goal'],'[status] ',p2p_delivery_status['status']].join('')));$engine.pub('/delivery_status', 'simple_delivery_msgs/DeliveryStatus', p2p_delivery_status['status']);}, function(item){  $engine.print(\"Rocon Authoring :\" + JSON.stringify('Action timeout of p2p_deliver_order'));}, {\"timeout\":$engine.getServiceParameter('p2p_delivery', 'action_timeout')}); }else{   $engine.print(\"Rocon Authoring :\" + JSON.stringify('Resource allocation failed for P2P delivery'));} })($engine.allocateResource(\"concert_demo_rapps/p2p_delivery\", \"rocon:/\", [{\"remap_from\":\"map\",\"remap_to\":\"/map\"},{\"remap_from\":\"map_metadata\",\"remap_to\":\"/map_metadata\"},{\"remap_from\":\"location_list\",\"remap_to\":\"/annotation/tables\"},{\"remap_from\":\"global_marker_list\",\"remap_to\":\"/annotation/ar_markers\"},{\"remap_from\":\"p2p_delivery_order\",\"remap_to\":\"\"}], [{\"key\":\"volume\",\"value\":\"80\"}], {\"type\":\"dynamic\",\"timeout\":$engine.getServiceParameter('p2p_delivery', 'alloc_timeout')}));}).run(); }, 0); });","xml":"<xml xmlns=\"http://www.w3.org/1999/xhtml\"><block type=\"action_speak\" id=\"12039\" inline=\"false\" x=\"135\" y=\"46\"><value name=\"VALUE\"><block type=\"text\" id=\"12040\"><field name=\"TEXT\">Start P2P delivery service</field></block></value></block><block type=\"ros_subscribe\" id=\"12041\" inline=\"true\" x=\"138\" y=\"122\"><mutation></mutation><field name=\"DO_PARAM\">item</field><value name=\"NAME\"><block type=\"text\" id=\"12042\"><field name=\"TEXT\">/p2p_delivery_order_from_ui</field></block></value><value name=\"TYPE\"><block type=\"text\" id=\"12043\"><field name=\"TEXT\">simple_delivery_msgs/P2PDeliveryOrder4UI</field></block></value><statement name=\"DO\"><block type=\"defer\" id=\"12044\"><statement name=\"DO\"><block type=\"action_speak\" id=\"12045\" inline=\"false\"><value name=\"VALUE\"><block type=\"text_join\" id=\"12046\" inline=\"false\"><mutation items=\"6\"></mutation><value name=\"ADD0\"><block type=\"text\" id=\"12047\"><field name=\"TEXT\">[p2p_delivery_order id] </field></block></value><value name=\"ADD1\"><block type=\"object_item_get\" id=\"12048\"><field name=\"VAR\">item</field><field name=\"KEY\">id</field></block></value><value name=\"ADD2\"><block type=\"text\" id=\"12049\"><field name=\"TEXT\">[sender] </field></block></value><value name=\"ADD3\"><block type=\"object_item_get\" id=\"12050\"><field name=\"VAR\">item</field><field name=\"KEY\">sender</field></block></value><value name=\"ADD4\"><block type=\"text\" id=\"12051\"><field name=\"TEXT\">[receiver] </field></block></value><value name=\"ADD5\"><block type=\"object_item_get\" id=\"12052\"><field name=\"VAR\">item</field><field name=\"KEY\">receiver</field></block></value></block></value><next><block type=\"ros_requester_allocate_with_block2\" id=\"12053\" inline=\"false\"><mutation extra_config=\"{&quot;timeout&quot;:&quot;15000000&quot;,&quot;remappings&quot;:[{&quot;remap_from&quot;:&quot;map&quot;,&quot;remap_to&quot;:&quot;/map&quot;},{&quot;remap_from&quot;:&quot;map_metadata&quot;,&quot;remap_to&quot;:&quot;/map_metadata&quot;},{&quot;remap_from&quot;:&quot;location_list&quot;,&quot;remap_to&quot;:&quot;/annotation/tables&quot;},{&quot;remap_from&quot;:&quot;global_marker_list&quot;,&quot;remap_to&quot;:&quot;/annotation/ar_markers&quot;},{&quot;remap_from&quot;:&quot;p2p_delivery_order&quot;,&quot;remap_to&quot;:&quot;&quot;}],&quot;parameters&quot;:[{&quot;key&quot;:&quot;volume&quot;,&quot;value&quot;:&quot;80&quot;}],&quot;rapp&quot;:&quot;concert_demo_rapps/p2p_delivery&quot;,&quot;uri&quot;:&quot;rocon:/&quot;}\"></mutation><field name=\"TYPE\">dynamic</field><field name=\"ON_SUCCESS_PARAM\">p2p_waiterbot</field><value name=\"TIMEOUT_ALLOC\"><block type=\"ros_parameter\" id=\"12054\"><mutation></mutation><field name=\"KEY\">alloc_timeout</field></block></value><statement name=\"ON_SUCCESS\"><block type=\"action_speak\" id=\"12055\" inline=\"false\"><value name=\"VALUE\"><block type=\"text\" id=\"12056\"><field name=\"TEXT\">Resource allocation succeeded for P2P delivery</field></block></value><next><block type=\"ros_scheduled_action_t_p2p_delivery_order\" id=\"12057\" inline=\"true\"><mutation></mutation><field name=\"ON_RESULT_PARAM\">item</field><field name=\"ON_FEEDBACK_PARAM\">item</field><field name=\"ON_TIMEOUT_PARAM\">item</field><value name=\"CTX\"><block type=\"variables_get\" id=\"12058\"><field name=\"VAR\">p2p_waiterbot</field></block></value><value name=\"GOAL\"><block type=\"ros_msg_simple_delivery_msgs-P2PDeliveryOrderGoal\" id=\"12059\" inline=\"false\"><mutation></mutation><value name=\"ORDER_ID\"><block type=\"object_item_get\" id=\"12060\"><field name=\"VAR\">item</field><field name=\"KEY\">id</field></block></value><value name=\"SENDER\"><block type=\"object_item_get\" id=\"12061\"><field name=\"VAR\">item</field><field name=\"KEY\">sender</field></block></value><value name=\"RECEIVER\"><block type=\"object_item_get\" id=\"12062\"><field name=\"VAR\">item</field><field name=\"KEY\">receiver</field></block></value><value name=\"MESSAGE\"><block type=\"text\" id=\"12063\"><field name=\"TEXT\">HELLOW</field></block></value></block></value><value name=\"TIMEOUT\"><block type=\"ros_parameter\" id=\"12064\"><mutation></mutation><field name=\"KEY\">action_timeout</field></block></value><statement name=\"ON_RESULT\"><block type=\"action_speak\" id=\"12065\" inline=\"false\"><value name=\"VALUE\"><block type=\"text_join\" id=\"12066\" inline=\"false\"><mutation items=\"4\"></mutation><value name=\"ADD0\"><block type=\"text\" id=\"12067\"><field name=\"TEXT\">[order_id] </field></block></value><value name=\"ADD1\"><block type=\"object_item_get\" id=\"12068\"><field name=\"VAR\">item</field><field name=\"KEY\">order_id</field></block></value><value name=\"ADD2\"><block type=\"text\" id=\"12069\"><field name=\"TEXT\">[success] </field></block></value><value name=\"ADD3\"><block type=\"object_item_get\" id=\"12070\"><field name=\"VAR\">item</field><field name=\"KEY\">success</field></block></value></block></value></block></statement><statement name=\"ON_FEEDBACK\"><block type=\"variables_set\" id=\"12071\" inline=\"true\"><field name=\"VAR\">p2p_delivery_status</field><value name=\"VALUE\"><block type=\"object_item_get\" id=\"12072\"><field name=\"VAR\">item</field><field name=\"KEY\">delivery_status</field></block></value><next><block type=\"action_speak\" id=\"12073\" inline=\"false\"><value name=\"VALUE\"><block type=\"text_join\" id=\"12074\" inline=\"false\"><mutation items=\"6\"></mutation><value name=\"ADD0\"><block type=\"text\" id=\"12075\"><field name=\"TEXT\">[p2p_delivery_order id] </field></block></value><value name=\"ADD1\"><block type=\"object_item_get\" id=\"12076\"><field name=\"VAR\">p2p_delivery_status</field><field name=\"KEY\">id</field></block></value><value name=\"ADD2\"><block type=\"text\" id=\"12077\"><field name=\"TEXT\">[target_goal] </field></block></value><value name=\"ADD3\"><block type=\"object_item_get\" id=\"12078\"><field name=\"VAR\">p2p_delivery_status</field><field name=\"KEY\">target_goal</field></block></value><value name=\"ADD4\"><block type=\"text\" id=\"12079\"><field name=\"TEXT\">[status] </field></block></value><value name=\"ADD5\"><block type=\"object_item_get\" id=\"12080\"><field name=\"VAR\">p2p_delivery_status</field><field name=\"KEY\">status</field></block></value></block></value><next><block type=\"ros_publish\" id=\"12081\" inline=\"true\"><mutation></mutation><value name=\"NAME\"><block type=\"text\" id=\"12082\"><field name=\"TEXT\">/delivery_status</field></block></value><value name=\"TYPE\"><block type=\"text\" id=\"12083\"><field name=\"TEXT\">simple_delivery_msgs/DeliveryStatus</field></block></value><value name=\"VALUE\"><block type=\"object_item_get\" id=\"12084\"><field name=\"VAR\">p2p_delivery_status</field><field name=\"KEY\">status</field></block></value></block></next></block></next></block></statement><statement name=\"ON_TIMEOUT\"><block type=\"action_speak\" id=\"12085\" inline=\"false\"><value name=\"VALUE\"><block type=\"text\" id=\"12086\"><field name=\"TEXT\">Action timeout of p2p_deliver_order</field></block></value></block></statement></block></next></block></statement><statement name=\"ON_FAIL\"><block type=\"action_speak\" id=\"12087\" inline=\"false\"><value name=\"VALUE\"><block type=\"text\" id=\"12088\"><field name=\"TEXT\">Resource allocation failed for P2P delivery</field></block></value></block></statement></block></next></block></statement></block></statement></block></xml>","title":"p2p_delivery_wf","description":"Service Description","created_at":1443068644272}