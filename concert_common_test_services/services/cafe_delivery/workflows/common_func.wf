{"id":"c6c2af809fae610c2716ea275182d247","js":"var res;\nvar id;\nvar color;\nvar light_ids;\nvar hue_res;\nvar g_hue_res;\nvar light_id;\n\nfunction set_hue_color(res, id, color) {\n  $engine.scheduledPublish(res, \"set_hue\", \"rocon_device_msgs/Hue\", ({\"light_id\":id,\"type\":'',\"name\":'',\"modelid\":'',\"swvesion\":'',\"state\":({\"on\":false,\"hue\":0,\"sat\":0,\"bri\":0,\"reachable\":false,\"color\":color})}));}\n\nfunction UDF_set_light(light_ids, color) {\n  setTimeout(function(){ Fiber(function(){  if (g_hue_res != null) {\n      for (var light_id_index in light_ids) {\n        light_id = light_ids[light_id_index];\n        set_hue_color(g_hue_res, light_id, color);\n      }\n    } else {\n      $engine.print(\"Rocon Authoring :\" + JSON.stringify('[Common Func] Resource Allocation Failure'));}\n  }).run(); }, 0);}\n\n\n$engine.print(\"Rocon Authoring :\" + JSON.stringify('[Common Function] Start Common Function'));setTimeout(function(){ Fiber(function(){  (function(hue_res){ if(hue_res){   g_hue_res = hue_res;\n    $engine.print(\"Rocon Authoring :\" + JSON.stringify('[Common Function] Hue resource allocation success'));UDF_set_light([1, 2, 3, 4, 5, 6, 7], 'OFF');\n   }else{   $engine.print(\"Rocon Authoring :\" + JSON.stringify('[Common Function] Hue resource allocation fail'));} })($engine.allocateResource(\"rocon_hue/hue_bridge\", \"rocon:/pc/hue_bridge#rocon_hue/hue_bridge\", [{\"remap_from\":\"set_hue\",\"remap_to\":\"/set_hue\"},{\"remap_from\":\"list_hue\",\"remap_to\":\"/list_hue\"}], [], {\"type\":\"static\",\"timeout\":$engine.getServiceParameter('cafe_delivery', 'alloc_timeout')}));}).run(); }, 0);","xml":"<xml xmlns=\"http://www.w3.org/1999/xhtml\"><block type=\"action_speak\" id=\"4712\" inline=\"false\" x=\"233\" y=\"-1154\"><value name=\"VALUE\"><block type=\"text\" id=\"4713\"><field name=\"TEXT\">[Common Function] Start Common Function</field></block></value><next><block type=\"defer\" id=\"4714\"><statement name=\"DO\"><block type=\"ros_requester_allocate_with_block2\" id=\"4715\" inline=\"false\"><mutation extra_config=\"{&quot;timeout&quot;:&quot;15000000&quot;,&quot;remappings&quot;:[{&quot;remap_from&quot;:&quot;set_hue&quot;,&quot;remap_to&quot;:&quot;/set_hue&quot;},{&quot;remap_from&quot;:&quot;list_hue&quot;,&quot;remap_to&quot;:&quot;/list_hue&quot;}],&quot;parameters&quot;:[],&quot;rapp&quot;:&quot;rocon_hue/hue_bridge&quot;,&quot;uri&quot;:&quot;rocon:/pc/hue_bridge#rocon_hue/hue_bridge&quot;}\"></mutation><field name=\"TYPE\">static</field><field name=\"ON_SUCCESS_PARAM\">hue_res</field><value name=\"TIMEOUT_ALLOC\"><block type=\"ros_parameter\" id=\"4716\"><mutation></mutation><field name=\"KEY\">alloc_timeout</field></block></value><statement name=\"ON_SUCCESS\"><block type=\"variables_set\" id=\"4717\" inline=\"true\"><field name=\"VAR\">g_hue_res</field><value name=\"VALUE\"><block type=\"variables_get\" id=\"4718\"><field name=\"VAR\">hue_res</field></block></value><next><block type=\"action_speak\" id=\"4719\" inline=\"false\"><value name=\"VALUE\"><block type=\"text\" id=\"4720\"><field name=\"TEXT\">[Common Function] Hue resource allocation success</field></block></value><next><block type=\"procedures_callnoreturn\" id=\"4721\" inline=\"false\"><mutation name=\"UDF_set_light\"><arg name=\"light_ids\"></arg><arg name=\"color\"></arg></mutation><value name=\"ARG0\"><block type=\"lists_create_with\" id=\"4722\" inline=\"false\"><mutation items=\"7\"></mutation><value name=\"ADD0\"><block type=\"math_number\" id=\"4723\"><field name=\"NUM\">1</field></block></value><value name=\"ADD1\"><block type=\"math_number\" id=\"4724\"><field name=\"NUM\">2</field></block></value><value name=\"ADD2\"><block type=\"math_number\" id=\"4725\"><field name=\"NUM\">3</field></block></value><value name=\"ADD3\"><block type=\"math_number\" id=\"4769\"><field name=\"NUM\">4</field></block></value><value name=\"ADD4\"><block type=\"math_number\" id=\"4770\"><field name=\"NUM\">5</field></block></value><value name=\"ADD5\"><block type=\"math_number\" id=\"4771\"><field name=\"NUM\">6</field></block></value><value name=\"ADD6\"><block type=\"math_number\" id=\"4772\"><field name=\"NUM\">7</field></block></value></block></value><value name=\"ARG1\"><block type=\"text\" id=\"4726\"><field name=\"TEXT\">OFF</field></block></value></block></next></block></next></block></statement><statement name=\"ON_FAIL\"><block type=\"action_speak\" id=\"4727\" inline=\"false\"><value name=\"VALUE\"><block type=\"text\" id=\"4728\"><field name=\"TEXT\">[Common Function] Hue resource allocation fail</field></block></value></block></statement></block></statement></block></next></block><block type=\"procedures_defnoreturn\" id=\"4729\" x=\"997\" y=\"-969\"><mutation><arg name=\"res\"></arg><arg name=\"id\"></arg><arg name=\"color\"></arg></mutation><field name=\"NAME\">set_hue_color</field><statement name=\"STACK\"><block type=\"ros_scheduled_publish_set_hue\" id=\"4730\" inline=\"true\"><mutation extra_config=\"{&quot;rapp&quot;:&quot;&quot;,&quot;uri&quot;:&quot;&quot;,&quot;timeout&quot;:15000,&quot;remappings&quot;:[],&quot;parameters&quot;:[]}\"></mutation><value name=\"CTX\"><block type=\"variables_get\" id=\"4731\"><field name=\"VAR\">res</field></block></value><value name=\"VALUE\"><block type=\"ros_msg_rocon_device_msgs-Hue\" id=\"4732\" inline=\"false\"><mutation></mutation><field name=\"SELECT_TYPE\">__</field><value name=\"LIGHT_ID\"><block type=\"variables_get\" id=\"4733\"><field name=\"VAR\">id</field></block></value><value name=\"TYPE\"><block type=\"text\" id=\"4734\"><field name=\"TEXT\"></field></block></value><value name=\"NAME\"><block type=\"text\" id=\"4735\"><field name=\"TEXT\"></field></block></value><value name=\"MODELID\"><block type=\"text\" id=\"4736\"><field name=\"TEXT\"></field></block></value><value name=\"SWVESION\"><block type=\"text\" id=\"4737\"><field name=\"TEXT\"></field></block></value><value name=\"STATE\"><block type=\"ros_msg_rocon_device_msgs-HueState\" id=\"4738\" inline=\"false\"><mutation></mutation><field name=\"SELECT_COLOR\">__</field><value name=\"ON\"><block type=\"logic_boolean\" id=\"4739\"><field name=\"BOOL\">FALSE</field></block></value><value name=\"HUE\"><block type=\"math_number\" id=\"4740\"><field name=\"NUM\">0</field></block></value><value name=\"SAT\"><block type=\"math_number\" id=\"4741\"><field name=\"NUM\">0</field></block></value><value name=\"BRI\"><block type=\"math_number\" id=\"4742\"><field name=\"NUM\">0</field></block></value><value name=\"REACHABLE\"><block type=\"logic_boolean\" id=\"4743\"><field name=\"BOOL\">FALSE</field></block></value><value name=\"COLOR\"><block type=\"variables_get\" id=\"4744\"><field name=\"VAR\">color</field></block></value></block></value></block></value></block></statement></block><block type=\"procedures_defnoreturn\" id=\"4745\" x=\"234\" y=\"-638\"><mutation><arg name=\"light_ids\"></arg><arg name=\"color\"></arg></mutation><field name=\"NAME\">UDF_set_light</field><statement name=\"STACK\"><block type=\"defer\" id=\"4746\"><statement name=\"DO\"><block type=\"controls_if\" id=\"4747\" inline=\"false\"><mutation else=\"1\"></mutation><value name=\"IF0\"><block type=\"logic_compare\" id=\"4748\" inline=\"true\"><field name=\"OP\">NEQ</field><value name=\"A\"><block type=\"variables_get\" id=\"4749\"><field name=\"VAR\">g_hue_res</field></block></value><value name=\"B\"><block type=\"logic_null\" id=\"4750\"></block></value></block></value><statement name=\"DO0\"><block type=\"controls_forEach\" id=\"4751\" inline=\"false\"><field name=\"VAR\">light_id</field><value name=\"LIST\"><block type=\"variables_get\" id=\"4752\"><field name=\"VAR\">light_ids</field></block></value><statement name=\"DO\"><block type=\"procedures_callnoreturn\" id=\"4753\" inline=\"false\"><mutation name=\"set_hue_color\"><arg name=\"res\"></arg><arg name=\"id\"></arg><arg name=\"color\"></arg></mutation><value name=\"ARG0\"><block type=\"variables_get\" id=\"4754\"><field name=\"VAR\">g_hue_res</field></block></value><value name=\"ARG1\"><block type=\"variables_get\" id=\"4755\"><field name=\"VAR\">light_id</field></block></value><value name=\"ARG2\"><block type=\"variables_get\" id=\"4756\"><field name=\"VAR\">color</field></block></value></block></statement></block></statement><statement name=\"ELSE\"><block type=\"action_speak\" id=\"4757\" inline=\"false\"><value name=\"VALUE\"><block type=\"text\" id=\"4758\"><field name=\"TEXT\">[Common Func] Resource Allocation Failure</field></block></value></block></statement></block></statement></block></statement></block></xml>","title":"common_func"}